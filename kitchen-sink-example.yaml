# The file format version
file_format: "0.1"
exporters: &otlp-exporter
  otlp:
    # Sets the protocol.
    #
    # Environment variable: OTEL_EXPORTER_OTLP_PROTOCOL, OTEL_EXPORTER_OTLP_METRICS_PROTOCOL
    protocol: http/protobuf
    # Sets the endpoint.
    #
    # Environment variable: OTEL_EXPORTER_OTLP_ENDPOINT, OTEL_EXPORTER_OTLP_METRICS_ENDPOINT
    endpoint: http://localhost:4318/v1/metrics
    # Sets the certificate.
    #
    # Environment variable: OTEL_EXPORTER_OTLP_CERTIFICATE, OTEL_EXPORTER_OTLP_METRICS_CERTIFICATE
    certificate: /app/cert.pem
    # Sets the mTLS private client key.
    #
    # Environment variable: OTEL_EXPORTER_OTLP_CLIENT_KEY, OTEL_EXPORTER_OTLP_METRICS_CLIENT_KEY
    client_key: /app/cert.pem
    # Sets the mTLS client certificate.
    #
    # Environment variable: OTEL_EXPORTER_OTLP_CLIENT_CERTIFICATE, OTEL_EXPORTER_OTLP_METRICS_CLIENT_CERTIFICATE
    client_certificate: /app/cert.pem
    # Sets the headers.
    #
    # Environment variable: OTEL_EXPORTER_OTLP_HEADERS, OTEL_EXPORTER_OTLP_METRICS_HEADERS
    headers:
      api-key: 1234
    # Sets the compression.
    #
    # Environment variable: OTEL_EXPORTER_OTLP_COMPRESSION, OTEL_EXPORTER_OTLP_METRICS_COMPRESSION
    compression: gzip
    # Sets the max time to wait for each export.
    #
    # Environment variable: OTEL_EXPORTER_OTLP_TIMEOUT, OTEL_EXPORTER_OTLP_METRICS_TIMEOUT
    timeout: 10000

# Configure general attribute limits. See also tracer_provider.span_limits, logger_provider.logrecord_limits.
attribute_limits:
  # Set the max attribute value size.
  #
  # Environment variable: OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT
  attribute_value_length_limit: 4096
  # Set the max attribute count.
  #
  # Environment variable: OTEL_ATTRIBUTE_COUNT_LIMIT
  attribute_count_limit: 128

# Configure logger provider.
logger_provider:
  # Configure the log record limits. See also attribute_limits.
  logrecord_limits:
    # Set the max log record attribute value size. Overrides attribute_limits.attribute_value_length_limit.
    #
    # Environment variable: OTEL_LOGRECORD_ATTRIBUTE_VALUE_LENGTH_LIMIT
    attribute_value_length_limit: 4096
    # Set the max log record attribute count. Overrides attribute_limits.attribute_count_limit.
    #
    # Environment variable: OTEL_LOGRECORD_ATTRIBUTE_COUNT_LIMIT
    attribute_count_limit: 128

# Configure meter provider.
meter_provider:
  metric_readers:
    # Add a pull-based metric reader.
    pull/prometheus:
      exporter:
        prometheus:
          # Set the host used to serve metrics in the prometheus format.
          #
          # Environment variable: OTEL_EXPORTER_PROMETHEUS_HOST
          host: localhost
          # Set the port used to serve metrics in the prometheus format.
          #
          # Environment variable: OTEL_EXPORTER_PROMETHEUS_PORT
          port: 9464
    # Add a periodic metric reader.
    #
    # Environment variable: OTEL_METRICS_EXPORT_*, OTEL_METRICS_EXPORTER
    periodic/otlp:
      # Sets delay interval between the start of two consecutive export attempts.
      #
      # Environment variable: OTEL_METRIC_EXPORT_INTERVAL
      interval: 5000
      # Sets the maximum allowed time to export data.
      #
      # Environment variable: OTEL_METRIC_EXPORT_TIMEOUT
      timeout: 30000
      # Sets the exporter. Exporter must refer to a key in sdk.meter_provider.exporters.
      #
      # Environment variable: OTEL_METRICS_EXPORTER
      exporter:
        # expand the otlp-exporter anchor and add metric specific configuration
        <<: *otlp-exporter
        # Sets the temporality preference.
        #
        # Environment variable: OTEL_EXPORTER_OTLP_METRICS_TEMPORALITY_PREFERENCE
        temporality_preference: delta
        # Sets the default histogram aggregation.
        #
        # Environment variable: OTEL_EXPORTER_OTLP_METRICS_DEFAULT_HISTOGRAM_AGGREGATION
        default_histogram_aggregation: exponential_bucket_histogram
    periodic/console:
      exporter:
        console: {}

# Configure context propagators.
#
# Environment variable: OTEL_PROPAGATORS
propagators: [tracecontext, baggage, b3, b3multi, jaeger, xray, ottrace]

# Configure tracer provider.
tracer_provider:
  # Configure span limits. See also attribute_limits.
  span_limits:
    # Set the max span attribute value size. Overrides attribute_limits.attribute_value_length_limit.
    #
    # Environment variable: OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT
    attribute_value_length_limit: 4096
    # Set the max span attribute count. Overrides attribute_limits.attribute_count_limit.
    #
    # Environment variable: OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT
    attribute_count_limit: 128
    # Set the max span event count.
    #
    # Environment variable: OTEL_SPAN_EVENT_COUNT_LIMIT
    event_count_limit: 128
    # Set the max span link count.
    #
    # Environment variable: OTEL_SPAN_LINK_COUNT_LIMIT
    link_count_limit: 128
    # Set the max attributes per span event.
    #
    # Environment variable: OTEL_EVENT_ATTRIBUTE_COUNT_LIMIT
    event_attribute_count_limit: 128
    # Set the max attributes per span link.
    #
    # Environment variable: OTEL_LINK_ATTRIBUTE_COUNT_LIMIT
    link_attribute_count_limit: 128
  # Configure the sampler.
  sampler:
    # Set the sampler id. Known values include: always_on, always_off, jaeger_remote, parent_based, trace_id_ratio_based.
    #
    # Environment variable: OTEL_TRACES_SAMPLER=parentbased_*
    id: parent_based
    # Configure the parent_based root sampler.
    root:
      # Set the parent_based root sampler id.
      #
      # Environment variable: OTEL_TRACES_SAMPLER=parentbased_traceidratio
      id: trace_id_ratio_based
      # Set the trace_id_ratio_based sampler trace_id_ratio.
      #
      # Environment variable: OTEL_TRACES_SAMPLER_ARG=traceidratio=0.0001
      trace_id_ratio: 0.0001
    # Configure the parent_based remote_parent_sampled sampler.
    remote_parent_sampled:
      # Set parent_based remote_parent_sampled sampler id.
      id: always_on
    # Configure the parent_based remote_parent_not_sampled sampler.
    remote_parent_not_sampled:
      # Set parent_based remote_parent_not_sampled sampler id.
      id: always_off
    # Configure the parent_based local_parent_sampled sampler.
    local_parent_sampled:
      # Set parent_based local_parent_sampled sampler id.
      id: always_on
    # Configure the parent_based local_parent_not_sampled sampler.
    local_parent_not_sampled:
      # Set parent_based local_parent_not_sampled sampler id.
      id: always_off

# Configure resource for all signals.
resource:
  # Key-value pairs to be used as resource attributes.
  #
  # Environment variable: OTEL_RESOURCE_ATTRIBUTES
  attributes:
    # Sets the value of the `service.name` resource attribute
    #
    # Environment variable: OTEL_SERVICE_NAME
    service.name: !!str "unknown_service"
